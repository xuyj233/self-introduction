{{ define "main" }}
<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
    {{ with .Params.description }}<p class="post-description">{{ . }}</p>{{ end }}
    {{ $data := site.Data.publications }}
    {{ with $data.generated_at }}
      {{ $generated := time . }}
      <p class="last-updated">Last generated from CV on {{ $generated.Format "Jan 2, 2006" }}.</p>
    {{ end }}
  </header>

  <div class="post-content">
    {{ $data := site.Data.publications }}
    {{ if not $data }}
      <p>The publications data file is missing. Run <code>python scripts/update_publications.py</code> to generate it from the LaTeX CV.</p>
    {{ else }}
      {{ with $data.published }}
        {{ $sorted := sort . "year" "desc" }}
        {{ if gt (len $sorted) 0 }}
        <section class="selected-publications">
          <h2>Selected Publications</h2>
          <ol>
            {{ range first 3 $sorted }}
            <li>
              <strong>{{ .title }}</strong><br>
              {{ with .authors }}<span class="pub-authors">{{ . }}</span><br>{{ end }}
              {{ with .venue }}<span class="pub-venue">{{ . }}</span>{{ end }}
            </li>
            {{ end }}
          </ol>
        </section>
        {{ end }}
      {{ end }}

      {{ with $data.published }}
        <h2>Published Papers ({{ len . }})</h2>
        <ul>
          {{ range . }}
            <li>
              <p>
                <strong>{{ .title }}</strong><br>
                {{ with .authors }}<span class="pub-authors">{{ . }}</span><br>{{ end }}
                {{ with .venue }}<span class="pub-venue">{{ . }}</span><br>{{ end }}
                {{ with .note }}<span class="pub-note">{{ . }}</span>{{ end }}
              </p>
            </li>
          {{ end }}
        </ul>
      {{ end }}

      {{ with $data.ongoing }}
        <h2>Ongoing Papers ({{ len . }})</h2>
        <ul>
          {{ range . }}
            <li>
              <p>
                <strong>{{ .title }}</strong><br>
                {{ with .authors }}<span class="pub-authors">{{ . }}</span><br>{{ end }}
                {{ with .venue }}<span class="pub-venue">{{ . }}</span><br>{{ end }}
                {{ with .note }}<span class="pub-note">{{ . }}</span>{{ end }}
              </p>
            </li>
          {{ end }}
        </ul>
      {{ end }}
    {{ end }}
  </div>
</article>
{{ end }}

